class GameOfLIfe{constructor(t={}){this.options={...this.defaultOptions,...t},this.body=document.querySelector("body"),this.init_canvas(),this.draw_empty(),this.initEvents()}static game_init(t){return new GameOfLIfe(t)}defaultOptions={x:600,y:600,cellSize:5,interval:1e3/24,fieldColor:"#F3EEEA",cellColor:"#435585"};canvas;interval_id;cells;frameStart;frameEnd;frameSpeed;line;gen=0;alive=0;startBtn=document.querySelector("[data-start]");handBtn=document.querySelector("[data-fill]");refreshBtn=document.querySelector("[data-refresh]");randomBtn=document.querySelector("[data-random]");fColorInp=document.querySelector("[data-field-color]");cColorInp=document.querySelector("[data-cell-color]");widthInp=document.querySelector("[data-field-width]");heightInp=document.querySelector("[data-field-height]");cellSize=document.querySelector("[data-cell-size]");frameInp=document.querySelector("[data-framerate]");genInp=document.querySelector("[data-gen]");speedSel=document.querySelector("[data-speed]");aliveInp=document.querySelector("[data-alive]");init_canvas(){this.body.querySelector("canvas")?.remove(),this.canvas=document.createElement("canvas"),document.querySelector("body").insertAdjacentElement("afterbegin",this.canvas),this.check_data(),this.canvas.width=this.options.x,this.canvas.height=this.options.y,this.ctx=this.canvas.getContext("2d"),this.ctx.width=this.canvas.width,this.ctx.height=this.canvas.height,this.get_lines()}get_lines(){let t;t=this.options.cellSize>=3?1:.25,this.line=t}check_data(){let t,e;t=this.options.x%this.options.cellSize,e=this.options.y%this.options.cellSize,t>0&&(this.options.x=this.options.x-t),e>0&&(this.options.y=this.options.y-e),this.widthInp.value=this.options.x,this.heightInp.value=this.options.y,this.cellSize.value=this.options.cellSize,this.cColorInp.value=this.options.cellColor.replace("#",""),this.fColorInp.value=this.options.fieldColor.replace("#","")}zeros=()=>{let t,e,i,s,l,n=[];for(e=0,s=this.options.y/this.options.cellSize,l=this.options.x/this.options.cellSize;e<s;e++){for(i=0,t=[];i<l;i++)t[i]=0;n[e]=t}return n.rows=s,n.cols=l,n};initialize_cells=t=>{let e,i;for(e=0,this.alive=0;e<t.rows;e++)for(i=0;i<t.cols;i++).5>Math.random()&&(t[e][i]=1,this.alive++);return this.aliveInp.value=this.alive,t};draw_cells=(t,e)=>{let i,s;for(i=0,this.alive=0;i<e.rows;i++)for(s=0;s<e.cols;s++){1===e[i][s]?(t.fillStyle=this.options.cellColor,this.alive++):t.fillStyle=this.options.fieldColor;let l=i*this.options.cellSize,n=s*this.options.cellSize;t.fillRect(n+this.line,l+this.line,this.options.cellSize-2*this.line,this.options.cellSize-2*this.line)}this.aliveInp.value=this.alive};draw_empty(){this.cells=this.zeros(),this.draw_cells(this.ctx,this.cells),this.canvas.onclick=this.mouseEvent}copy_cells=(t,e)=>{var i,s;for(i=0;i<t.rows;i++)for(s=0;s<t.cols;s++)e[i][s]=t[i][s];return e};update=t=>{let e,i,s,l,n,o,a,h,r,c,v,d;for(e=0,n=this.copy_cells(t,this.zeros()),v=t.rows-1,d=t.cols-1;e<t.rows;e++)for(i=0;i<t.cols;i++){if(o=0,r=Math.max(0,e-1),c=Math.min(t.rows,e+2),a=Math.max(0,i-1),h=Math.min(t.cols,i+2),0===e)for(l=a;l<h;l++)1===n[v][l]&&o++;else if(e===v)for(l=a;l<h;l++)1===n[0][l]&&o++;if(0===i)for(l=r;l<c;l++)1===n[l][d]&&o++;else if(i===d)for(l=r;l<c;l++)1===n[l][0]&&o++;for(s=r;s<c;s++)for(l=a;l<h;l++)1===n[s][l]&&o++;1===n[e][i]?2!=--o&&3!==o&&(t[e][i]=0):3===o&&(t[e][i]=1)}return t};init_sim=()=>{this.cells=this.initialize_cells(this.zeros())};set_gen(t){"+"===t?this.gen++:this.gen=0,this.genInp.value=this.gen}run_sim=()=>{let t=this.cells,e=this.ctx;this.frameStart=performance.now(),this.update(t),this.draw_cells(e,t),this.frameEnd=performance.now(),this.frameInp.value=(this.frameEnd-this.frameStart).toFixed(2)+" /ms",this.set_gen("+")};on_key_press=t=>{let e=this;var i=String.fromCharCode(t.charCode);" "===i?e.interval_id?e.stopAction():(e.interval_id=window.setInterval(e.run_sim,e.options.interval),e.startBtn.textContent="Стоп"):"n"===i?e.run_sim():"r"===i&&(window.clearInterval(e.interval_id),e.init_sim(),e.interval_id=window.setInterval(e.run_sim,e.options.interval),e.set_gen("-"))};mouseEvent=t=>{this.interval_id&&this.stopAction();let e,i,s,l;e=Math.round((t.offsetY-this.options.cellSize/2)/this.options.y*this.cells.rows),i=Math.round((t.offsetX-this.options.cellSize/2)/this.options.x*this.cells.cols),1===this.cells[e][i]?(this.cells[e][i]=0,this.ctx.fillStyle=this.options.fieldColor,this.alive--):(this.cells[e][i]=1,this.ctx.fillStyle=this.options.cellColor,this.alive++),s=i*this.options.cellSize,l=e*this.options.cellSize,this.ctx.fillRect(s+this.line,l+this.line,this.options.cellSize-2*this.line,this.options.cellSize-2*this.line),this.aliveInp.value=this.alive};stopAction(){window.clearInterval(this.interval_id),this.interval_id=null,this.startBtn.textContent="Старт"}startEvent=()=>{let t=this;t.interval_id?t.stopAction():(t.interval_id=window.setInterval(t.run_sim,t.options.interval),t.startBtn.textContent="Стоп")};handEvent=()=>{this.stopAction(),this.init_canvas(),this.cells=this.zeros(),this.draw_cells(this.ctx,this.cells),this.canvas.onclick=this.mouseEvent,this.set_gen("-")};randomEvent=()=>{this.stopAction(),this.init_canvas(),this.init_sim(),this.draw_cells(this.ctx,this.cells),this.canvas.onclick=this.mouseEvent,this.set_gen("-")};fieldColorEvent=t=>{t.target.value.length>=3&&t.target.value.length<=6&&(this.options.fieldColor="#"+t.target.value)};cellColorEvent=t=>{t.target.value.length>=3&&t.target.value.length<=6&&(this.options.cellColor="#"+t.target.value)};fieldWithEvent=t=>{this.stopAction(),setTimeout(()=>{this.options.x=t.target.value,this.init_canvas(),this.draw_empty()},1e3),this.set_gen("-")};fieldHeigthEvent=t=>{this.stopAction(),setTimeout(()=>{this.options.y=t.target.value,this.init_canvas(),this.draw_empty()},1e3),this.set_gen("-")};cellSizeEvent=t=>{this.stopAction(),setTimeout(()=>{this.options.cellSize=t.target.value,this.init_canvas(),this.draw_empty()},1e3)};speedEvent=t=>{this.interval_id?(this.stopAction(),this.options.interval=t.target.value,this.startEvent()):this.options.interval=t.target.value};initEvents(){this.startBtn.addEventListener("click",this.startEvent),this.handBtn.addEventListener("click",this.handEvent),this.randomBtn.addEventListener("click",this.randomEvent),this.fColorInp.addEventListener("input",this.fieldColorEvent),this.cColorInp.addEventListener("input",this.cellColorEvent),this.widthInp.addEventListener("input",this.fieldWithEvent),this.heightInp.addEventListener("input",this.fieldHeigthEvent),this.cellSize.addEventListener("input",this.cellSizeEvent),this.speedSel.addEventListener("change",this.speedEvent),window.onkeypress=this.on_key_press}}document.addEventListener("DOMContentLoaded",function(){GameOfLIfe.game_init(),document.querySelectorAll("input").forEach(t=>{active_label(t),t.addEventListener("input",function(t){t.preventDefault(),active_label(this)}),t.addEventListener("change",function(t){t.preventDefault(),active_label(this)})})});let active_label=function(t){""!==t.value?t.classList.add("active"):t.classList.remove("active")};